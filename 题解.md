## 预处理
也就是处理数据和统一格式
### 数据清洗
数据有效性验证：根据题目要求，“将成分比例累加和介于85%~105%之间的数据视为有效数据” 。此规则旨在排除因测量误差、仪器限制或样本污染导致的异常数据点。在合并后的数据集上，对每个样本的所有化学成分比例求和。经过检验，所有样本的成分总和均在此范围内，因此全部样本均被视为有效数据，无需剔除。   

缺失数据（零值）处理：表单2 中的空白单元格表示该成分“未检测到” 。这并非传统意义上的随机缺失值，而应被理解为“低于检测限”的测量结果，在成分数据分析中被称为“取整零值”（rounded zeros）。由于后续的对数比变换无法处理零值（$\log(0)$ 未定义），必须对这些零值进行审慎处理。

一种简单的方法是用一个极小的常数（如0.01%）替换零值，但这会严重扭曲数据中各组分间的比例关系，而这正是成分数据所包含的核心信息 。一种更科学、更受推荐的方法是   
乘法替换法（multiplicative replacement）。该方法不仅用一个小值    
### 数据处理
成分数据具有“常数和约束”（所有组分百分比之和为100%）。这一约束导致了变量间的伪负相关，并违反了许多统计模型所要求的独立性假设 。例如，在一个三组分系统中，一个组分的增加必然导致其他一个或两个组分的减少，即使它们在物理或化学上并无关联。这种固有的数据结构会产生误导性的分析结果。 

$$
\text{clr}(x)_i = \log \left( \frac{x_i}{g(x)} \right)
$$
其中 $g(x) = (\prod_{j=1}^{D} x_j)^{1/D}$ 是成分向量 $x$ 的几何平均值。CLR变换的每个分量都反映了该组分相对于样本整体几何平均值的富集或亏损程度，它保留了各组分间的相对关系，非常适合用于探索性分析和相关性分析。所有后续的统计分析，除非特别说明，都将基于CLR变换后的数据进行


$$
r_j = \begin{cases}
\delta & \text{if } x_j = 0 \\
x_j \cdot (1 - c\delta) & \text{if } x_j > 0
\end{cases}
$$

$\delta$ 替换零值，同时按比例缩放所有其他非零组分，以最大程度地保留原始非零组分间的比率结构。具体操作如下：对于一个包含 $c$ 个零值的样本，其替换后的新组分 $r_j$ 由下式给出 ：   

其中 $x_j$ 是原始组分比例。$\delta$ 的取值通常建议为检测限的65%左右。在没有具体检测限信息的情况下，可选择一个相对于数据集中最小非零值而言足够小的数值（例如，$10^{-5}$）。此方法通过保持非零组分间的相对关系，确保了数据内在结构的完整性，为后续分析提供了可靠基础。

其中 $x_j$ 是原始组分比例。$\delta$ 的取值通常建议为检测限的65%左右。在没有具体检测限信息的情况下，可选择一个相对于数据集中最小非零值而言足够小的数值（例如，$10^{-5}$）。此方法通过保持非零组分间的相对关系，确保了数据内在结构的完整性，为后续分析提供了可靠基础。


## 问题一
核心是分析玻璃表面风化与其它物理属性（类型、纹饰、颜色）的关系；
其次，量化风化的化学影响，并建立一个预测模型来推断文物风化前的原始化学成分。
最后预测风化后的影响

### 1.1 风化与物理属性的统计关联分析
模型建立：构建列联表，并采用卡方独立性检验（Chi-squared test of independence）来评估变量间的关联强度。此检验的原假设是两个变量相互独立。若p值小于显著性水平（通常设为0.05），则拒绝原假设，认为变量间存在显著关联。

分析结果

2.1 风化与物理属性的关联分析:
风化状态 vs. 玻璃类型 的卡方检验 p-value: 0.0195
结论: 风化与玻璃类型存在显著关联。
| 风化状态 | 铅钡 | 高钾 |
| --- | ---: | ---: |
| 无风化 | 12 | 12 |
| 风化 | 28 | 6 |

风化状态 vs. 纹饰 的卡方检验 p-value: 0.0839
结论: 风化与纹饰无显著关联。
| 风化状态 | A | B | C |
| --- | ---: | ---: | ---: |
| 无风化 | 11 | 0 | 13 |
| 风化 | 11 | 6 | 17 |

### 1.2 风化化学特征量化
要准确理解风化过程中的化学变化规律，最理想的方法是比较同一件文物风化区域和未风化区域的成分差异。数据  中恰好提供了此类成对样本（例如，文物08的风化点与严重风化点，以及文物49的风化样本与其未风化点），这为我们提供了一个天然的对照实验。直接比较所有风化样本与所有未风化样本的平均成分是不可靠的，因为这会混淆风化效应与文物本身的成分差异。

建模：
- 筛选成对样本：从数据集中识别出所有来自同一文物编号但风化状态不同的成对样本（如 08 vs. 08严重风化点, 26 vs. 26严重风化点, 49 vs. 49未风化点, 50 vs. 50未风化点等）。

- CLR变换：对这些成对样本的化学成分进行CLR变换。

- 计算差异向量：对每一对样本，计算其CLR变换后的差异向量：$\Delta_{\text{clr}} = \text{CLR}(\text{风化样本}) - \text{CLR}(\text{未风化样本})$。这个向量的每个分量代表了相应化学元素在风化过程中相对于几何平均值的对数比变化。

- 统计检验：对所有差异向量的每个分量进行配对样本t检验（paired t-test）。检验每个化学成分的平均变化是否显著不为零。

结果

风化效应量化（CLR 空间）：
| 成分 | 均值差(风化-未风化, CLR) | t统计量 | p值 | 方向 | 显著性 |
| --- | ---: | ---: | ---: | --- | --- |
| 氧化铁(Fe2O3) | 1.437802 | 1.372283 | 0.241897 | 富集(风化↑) | |
| 氧化钡(BaO) | -1.396295 | -0.930570 | 0.404752 | 流失(风化↓) | |
| 氧化钙(CaO) | -1.029807 | -0.733184 | 0.504099 | 流失(风化↓) | |
| 氧化钾(K2O) | -1.002261 | -0.520032 | 0.630495 | 流失(风化↓) | |
| 二氧化硫(SO2) | 0.872661 | 1.936718 | 0.124847 | 富集(风化↑) | |
| 二氧化硅(SiO2) | -0.866966 | -1.440004 | 0.223286 | 流失(风化↓) | |
| 五氧化二磷(P2O5) | 0.836536 | 1.538125 | 0.198842 | 富集(风化↑) | |
| 氧化锶(SrO) | 0.607155 | 1.850360 | 0.137932 | 富集(风化↑) | |
| 氧化铅(PbO) | 0.316121 | 0.871778 | 0.432531 | 富集(风化↑) | |
| 氧化镁(MgO) | 0.107901 | 0.295075 | 0.782619 | 富集(风化↑) | |
| 氧化锡(SnO2) | 0.097853 | 0.260397 | 0.807413 | 富集(风化↑) | |
| 氧化钠(Na2O) | 0.097853 | 0.260397 | 0.807413 | 富集(风化↑) | |
| 氧化铜(CuO) | -0.048549 | -0.073924 | 0.944620 | 流失(风化↓) | |
| 氧化铝(Al2O3) | -0.030006 | -0.070590 | 0.947112 | 流失(风化↓) | |

- 结论
助熔剂和稳定剂的显著流失 (Depletion):

氧化钡 (BaO): 均值差 -1.396 (负值，流失)

氧化钙 (CaO): 均值差 -1.030 (负值，流失)

氧化钾 (K2O): 均值差 -1.002 (负值，流失)

结论: 这三者是玻璃中典型的助熔剂（BaO, K2O）和稳定剂（CaO）。它们的化学性质相对活泼，在长期的埋藏环境中容易与地下水发生离子交换而溶出、流失。尽管它们的p值没有达到0.05的显著水平（这很可能是由于样本量小造成的），但它们是所有成分中流失趋势最明显的几个，这与公认的玻璃风化机理完全吻-合。

氧化铁 (Fe2O3): 均值差 1.438

二氧化硫 (SO2): 均值差 0.873 (p值0.12, 趋势较明显)

五氧化二磷 (P2O5): 均值差 0.837 (p值0.19, 趋势较明显)

- 结论: 这些成分的相对富集，很可能不是玻璃“内部”的变化，而是与“外部”埋藏环境交换的结果。例如，土壤中的硫酸盐、磷酸盐、铁离子等可能会附着、渗透到风化后疏松多孔的玻璃表面，甚至发生化学反应生成新的稳定物质，从而导致检测时这些元素的含量相对升高。SO2和P2O5的富集尤其支持这一“外来污染物”的假说。



### 1.3 风化逆转预测模型

模型选择：由于化学成分数据是高维且高度共线（受常数和约束影响），标准的普通最小二乘（OLS）回归不适用。**偏最小二乘回归（Partial Least Squares Regression, PLS）**是解决此类问题的理想选择。PLS特别适用于化学计量学领域，能有效处理预测变量多于样本数且变量间存在严重共线性的情况 。   

模型构建与应用：

训练数据：使用2.2节中筛选出的成对样本。将CLR变换后的风化样本成分作为预测变量（X），CLR变换后的未风化样本成分作为响应变量（Y）。

模型训练：训练一个PLS回归模型，
形式为：$Y_{\text{未风化\_clr}} = \text{PLS}(X_{\text{风化\_clr}})$。
通过交叉验证来确定最佳的PLS主成分数量，以防止模型过拟合。

预测流程：对于一个新的风化样本，其预测流程如下：
1. 对其化学成分进行零值处理和CLR变换。
2. 将变换后的数据输入已训练好的PLS模型，得到预测的未风化成分的CLR值。
3. 对模型的输出结果进行逆CLR变换，将其转换回原始的百分比成分空间，得到最终的预测结果。

结论

- PLS 使用的组分数: 4 (上限 4)
- PLS模型在训练集上的 R² score: 1.0000

示例：预测样本'02'风化前的化学成分:
| 指标 | 二氧化硅(SiO2) | 氧化钾(K2O) | 氧化铅(PbO) | 氧化钡(BaO) |
| --- | ---: | ---: | ---: | ---: |
| 测量值 (风化) | 36.280000 | 1.050000 | 47.430000 | 0.00000 |
| 预测值 (风化前) | 39.791178 | 12.989248 | 22.193147 | 2.42414 |




